<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="SSL Certificate Inspector tool. Check domain security, certificate validity, and expiration dates." />
    <title>Nexus SSL Inspector</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        .ssl-scanner {
            max-width: 600px;
            margin: 2rem auto;
            text-align: center;
        }

        .input-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .url-input {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: 'Outfit', sans-serif;
            outline: none;
        }

        .url-input:focus {
            border-color: var(--accent-cyan);
        }

        .result-card {
            text-align: left;
            display: none;
            /* Hidden by default */
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .label {
            color: var(--text-secondary);
        }

        .value {
            font-weight: 600;
        }

        .cert-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(16, 185, 129, 0.1);
            color: var(--status-good);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .cert-badge.expired {
            background: rgba(239, 68, 68, 0.1);
            color: var(--status-danger);
            border-color: rgba(239, 68, 68, 0.2);
        }
    </style>
</head>

<body>
    <header class="glass">
        <a href="index.html" class="logo-container">
            <img src="assets/logo.png" alt="Nexus Logo" class="logo-img" />
            <span>NEXUS OPS</span>
        </a>
        <nav>
            <a href="index.html">Dashboard</a>
            <a href="network.html">Network Map</a>
            <a href="procedures.html">Procedures</a>
            <a href="ssl.html" class="active">SSL Tool</a>
            <a href="login.html" class="btn btn-outline" style="margin-left: 2rem; padding: 0.5rem 1rem;">Admin
                Login</a>
        </nav>
    </header>

    <div class="dashboard" style="margin-top: 4rem;">
        <div class="ssl-scanner">
            <h2 style="margin-bottom: 1rem;">SSL Certificate Inspector</h2>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                Analyze certificate chain, validity, and encryption strength.
            </p>

            <form onsubmit="runScan(event)">
                <div class="input-row">
                    <input type="text" id="urlInput" class="url-input" placeholder="Enter domain (e.g. google.com)"
                        required />
                    <button type="submit" class="btn btn-primary" id="scanBtn">Scan Domain</button>
                </div>
            </form>

            <!-- Loading State -->
            <div id="loading" style="display: none; padding: 2rem;">
                <div style="margin-bottom: 1rem;">Handshaking with server...</div>
                <div
                    style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; width: 60%; margin: 0 auto;">
                    <div id="progressBar"
                        style="width: 0%; height: 100%; background: var(--accent-cyan); transition: width 0.3s;"></div>
                </div>
            </div>

            <!-- Result Card -->
            <div id="result" class="glass glass-card result-card">
                <div id="statusBadge" class="cert-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    <span>Certificate Valid & Secure</span>
                </div>

                <h3 id="domainTitle" style="margin-bottom: 1.5rem;">google.com</h3>

                <div class="detail-row">
                    <span class="label">Issued By</span>
                    <span class="value" id="issuer">GTS CA 1C3</span>
                </div>
                <div class="detail-row">
                    <span class="label">Valid From</span>
                    <span class="value" id="validFrom">2025-10-14</span>
                </div>
                <div class="detail-row">
                    <span class="label">Expires On</span>
                    <span class="value" id="validTo" style="color: var(--status-good);">2026-01-06</span>
                </div>
                <div class="detail-row">
                    <span class="label">Days Remaining</span>
                    <span class="value" id="daysLeft">84 Days</span>
                </div>
                <div class="detail-row">
                    <span class="label">Encryption</span>
                    <span class="value">TLS 1.3 / AES_256_GCM</span>
                </div>
            </div>

        </div>
    </div>

    <script src="script.js"></script>
    <script>
        async function runScan(e) {
            e.preventDefault();
            const input = document.getElementById('urlInput');
            // Clean URL to get pure domain
            let domain = input.value.trim().replace(/https?:\/\//, '').replace(/\/$/, '');
            if (domain.includes('/')) domain = domain.split('/')[0];

            const btn = document.getElementById('scanBtn');

            // UI Reset
            document.getElementById('result').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('progressBar').style.width = '30%';
            btn.disabled = true;
            btn.innerText = 'Analyzing CT Logs...';

            try {
                // Fetch from Certificate Transparency Log
                const response = await fetch(`https://crt.sh/?q=${domain}&output=json`);
                if (!response.ok) throw new Error("API_ERROR");

                const data = await response.json();
                document.getElementById('progressBar').style.width = '70%';

                if (!data || data.length === 0) {
                    throw new Error("NO_DATA");
                }

                // Filter and sort to find the most relevant CURRENT certificate
                // crt.sh returns historical data too. We want the one that expires furthest in the future.
                const activeCerts = data.sort((a, b) => new Date(b.not_after) - new Date(a.not_after));
                const latestCert = activeCerts[0];

                // Process Data
                showResult(domain, latestCert);

            } catch (error) {
                console.error(error);
                if (error.message === "NO_DATA") {
                    alert("No certificate found for this domain in public logs. Please check the spelling.");
                } else {
                    // Fallback for demo purposes if API fails (CORS/Rate Limit)
                    alert("Could not connect to public CT logs (likely CORS restriction). Showing simulated data for demo.");
                    simulateResult(domain);
                }
                resetUI();
            }
        }

        function showResult(domain, cert) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            resetUI();

            document.getElementById('domainTitle').innerText = domain;

            // Parse Dates from crt.sh format: "2025-01-01T00:00:00"
            const validFrom = new Date(cert.not_before);
            const validTo = new Date(cert.not_after);
            const today = new Date();

            // Format Options
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            document.getElementById('validFrom').innerText = validFrom.toLocaleDateString('en-US', options);

            const validToElem = document.getElementById('validTo');
            validToElem.innerText = validTo.toLocaleDateString('en-US', options);

            // Days Left
            const diffTime = validTo - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            const badge = document.getElementById('statusBadge');
            const issuerName = cert.issuer_name.split('O=')[1]?.split(',')[0] || cert.issuer_name;
            document.getElementById('issuer').innerText = issuerName;

            // Status Logic
            if (diffDays < 0) {
                // Expired
                badge.className = 'cert-badge expired';
                badge.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                           <span>Certificate Expired</span>`;
                validToElem.style.color = 'var(--status-danger)';
                document.getElementById('daysLeft').innerText = Math.abs(diffDays) + ' Days Ago';
            } else {
                // Valid
                badge.className = 'cert-badge';
                badge.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                           <span>Certificate Valid & Secure</span>`;
                validToElem.style.color = 'var(--status-good)';
                document.getElementById('daysLeft').innerText = diffDays + ' Days';
            }
        }

        function resetUI() {
            const btn = document.getElementById('scanBtn');
            btn.disabled = false;
            btn.innerText = 'Scan Domain';
        }

        function simulateResult(domain) {
            // Keep simulation as a silent fallback if API fails
            document.getElementById('loading').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            // ... (Rest of classic simulation logic logic could trigger here, but simplifying for now)
            document.getElementById('domainTitle').innerText = domain + " (Simulated)";
            document.getElementById('daysLeft').innerText = "Simulated Mode";
        }
    </script>
</body>

</html>